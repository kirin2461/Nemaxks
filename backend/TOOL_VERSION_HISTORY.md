# История версий инструментов

## Что это такое?

**История версий** - это система, которая сохраняет все изменения инструмента (доски/тетради) и позволяет откатиться к любому предыдущему состоянию.

## Проблема, которую она решает

Представь, что происходит на уроке:

1. **10:00** - Учитель создал доску для задания
2. **10:15** - Ученик Боб добавил 3 элемента (правильно)
3. **10:30** - Ученик Алиса случайно удалила все содержание
4. **10:35** - Учитель заметил ошибку

**БЕЗ истории версий:** Содержание потеряно навсегда!
**С историей версий:** Учитель восстанавливает состояние на 10:15

## Как это работает

### Структура данных

```go
type ToolVersion struct {
    ID                uint   // ID версии
    ToolID            uint   // ID инструмента
    VersionNum        int    // Номер версии (1, 2, 3...)
    Title             string // Название
    Content           string // Содержание (JSON)
    ChangedBy         uint   // Кто сделал изменение
    ChangeDescription string // Описание (например: "Добавлены элементы")
    CreatedAt         int64  // Когда создана версия
}
```

### Пример истории версий

| Версия | Время | Кто | Изменение | Статус |
|--------|-------|-----|-----------|--------|
| V1 | 10:00 | Учитель | Создание доски | ✓ Текущая |
| V2 | 10:15 | Боб | Добавлены 3 элемента | ✓ Сохранена |
| V3 | 10:30 | Алиса | Удалены все элементы | ✓ Сохранена |
| V4 | 10:35 | Учитель | Восстановлена V2 | ✓ Текущая |

## API Endpoints

### 1. Получить историю версий
```
GET /api/channels/tools/:tool_id/history

Ответ:
{
  "tool_id": 123,
  "total_versions": 4,
  "versions": [
    {
      "id": 1,
      "version_number": 1,
      "title": "Доска примеров",
      "changed_by": 5,
      "change_description": "Создание",
      "created_at": 1704604800
    },
    ...
  ]
}
```

### 2. Восстановить версию
```
POST /api/channels/tools/:tool_id/restore?version=2

Ответ:
{
  "message": "Version restored",
  "version": 2
}
```

## Когда это полезно

✅ **В образовании:**
- Ученик случайно удалил работу → восстанавливаем
- Нужно увидеть прогресс → смотрим предыдущие версии
- Учитель хочет откатить неправильное редактирование

✅ **В совместной работе:**
- Несколько студентов редактируют одну доску
- Один случайно испортил содержание
- Легко вернуться к нужному состоянию

## Как использовать

### Для пользователей
1. Открываешь инструмент (доску/тетрадь)
2. Нажимаешь кнопку "История" (в будущем)
3. Видишь список всех версий с временем и автором
4. Нажимаешь на версию → "Восстановить"
5. Готово! Инструмент вернулся в нужное состояние

### Для разработчиков
```go
// При каждом обновлении инструмента вызываешь:
SaveToolSnapshot(
    toolID,
    "Новое название",
    jsonContent,
    userID,
    "Описание изменения"
)
```

## Важные моменты

⚠️ **Старые версии хранятся** - Хранятся последние 50 версий (можно изменить)
⚠️ **Видна информация о авторе** - Каждое изменение привязано к пользователю
⚠️ **Нельзя изменить историю** - История неизменна (для целостности данных)
⚠️ **При восстановлении создается новая версия** - Восстановление тоже записывается как версия

## Примеры использования

### Сценарий 1: Откат ошибки
```
Учитель заметил, что ученик удалил важное содержание.
Учитель:
1. Открывает историю
2. Видит версию 5 - там было все правильно
3. Нажимает "Восстановить версию 5"
4. Готово - содержание восстановлено!
```

### Сценарий 2: Проверка прогресса
```
Учитель хочет посмотреть, как развивалась идея студента.
Учитель:
1. Открывает историю
2. Смотрит версии 1 → 2 → 3 → 4 (как изменялось содержание)
3. Видит прогресс работы
4. Может дать обратную связь
```
